<head>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
  />
</head>

<h2 class="mb-4 text-xl font-bold">Colors</h2>

<div class="mb-4 flex items-center space-x-4">
  <span class="text-md font-bold">Hex</span>
  <label class="relative inline-flex cursor-pointer items-center">
    <input type="checkbox" id="colorToggle" class="peer sr-only" />
    <div class="h-6 w-11 rounded-full bg-blue transition-colors"></div>
    <div
      class="absolute left-1 top-1 h-4 w-4 rounded-full bg-white transition-transform peer-checked:translate-x-5"
    ></div>
  </label>
  <span class="text-md font-bold">RGB</span>
</div>

<div class="mt-8 grid grid-cols-1 gap-6" id="colorGrid"></div>

<h2 class="mb-4 mt-12 text-xl font-black font-bold">Datawrapper</h2>

<div style="min-height:449px" id="datawrapper-vis-1Dg8P">
  <script
    type="text/javascript"
    defer
    src="https://datawrapper.dwcdn.net/1Dg8P/embed.js"
    charset="utf-8"
    data-target="#datawrapper-vis-1Dg8P"
  ></script>
  <noscript
    ><img src="https://datawrapper.dwcdn.net/1Dg8P/full.png" alt=""
  /></noscript>
</div>

<h2 class="mb-4 mt-12 text-xl font-black font-bold">Flourish</h2>

<div class="flourish-embed flourish-map" data-src="visualisation/24021522">
  <script src="https://public.flourish.studio/resources/embed.js"></script>
  <noscript
    ><img
      src="https://public.flourish.studio/visualisation/24021522/thumbnail"
      width="100%"
      alt="map visualization"
  /></noscript>
</div>

<div class="mt-8 space-y-4" id="source-boxes">
  <div class="flex items-center space-x-4 rounded bg-white p-4 shadow">
    <label class="whitespace-nowrap text-sm font-semibold">Logo image:</label>
    <input
      type="text"
      value="https://public.flourish.studio/uploads/2422245/a2361592-f316-4297-8efe-adcb88774852.png"
      class="border-gray font-mono bg-gray flex-1 rounded border px-2 py-1 text-sm"
      readonly
    />
    <button
      class="copy-btn text-blue hover:text-blue"
      onclick="copySource(this)"
    >
      <i class="fas fa-clipboard"></i>
    </button>
  </div>

  <div class="flex items-center space-x-4 rounded bg-white p-4 shadow">
    <label class="whitespace-nowrap text-sm font-semibold">Logo Height:</label>
    <input
      type="text"
      value="2.3"
      class="border-gray font-mono bg-gray flex-1 rounded border px-2 py-1 text-sm"
      readonly
    />
    <button
      class="copy-btn text-blue hover:text-blue"
      onclick="copySource(this)"
    >
      <i class="fas fa-clipboard"></i>
    </button>
  </div>

  <div class="flex items-center space-x-4 rounded bg-white p-4 shadow">
    <label class="whitespace-nowrap text-sm font-semibold">Top Margin:</label>
    <input
      type="text"
      value="-0.1"
      class="border-gray font-mono bg-gray flex-1 rounded border px-2 py-1 text-sm"
      readonly
    />
    <button
      class="copy-btn text-blue hover:text-blue"
      onclick="copySource(this)"
    >
      <i class="fas fa-clipboard"></i>
    </button>
  </div>

  <div class="flex items-center space-x-4 rounded bg-white p-4 shadow">
    <label class="whitespace-nowrap text-sm font-semibold">Source label:</label>
    <input
      type="text"
      value="<b>Source:</b>"
      class="border-gray font-mono bg-gray flex-1 rounded border px-2 py-1 text-sm"
      readonly
    />
    <button
      class="copy-btn text-blue hover:text-blue"
      onclick="copySource(this)"
    >
      <i class="fas fa-clipboard"></i>
    </button>
  </div>

  <div class="flex items-center space-x-4 rounded bg-white p-4 shadow">
    <label class="whitespace-nowrap text-sm font-semibold">Note label:</label>
    <input
      type="text"
      value="<b>Graphic:</b>  First Last / Spotlight PA"
      class="border-gray font-mono bg-gray flex-1 rounded border px-2 py-1 text-sm"
      readonly
    />
    <button
      class="copy-btn text-blue hover:text-blue"
      onclick="copySource(this)"
    >
      <i class="fas fa-clipboard"></i>
    </button>
  </div>
</div>

<script>
  const colors = [
    { hex: "#2e2e2e", rgb: "rgb(46, 46, 46)" },
    { hex: "#ffcb03", rgb: "rgb(255, 203, 3)" },
    { hex: "#009edb", rgb: "rgb(0, 158, 219)" },
    { hex: "#78bc20", rgb: "rgb(120, 188, 32)" },
    { hex: "#d70000", rgb: "rgb(215, 0, 0)" },
    { hex: "#22416e", rgb: "rgb(34, 65, 110)" },
    { hex: "#1b998b", rgb: "rgb(27, 153, 139)" },
    { hex: "#ff6c36", rgb: "rgb(255, 108, 54)" },
  ];

  function hexToHSL(hex) {
    const r = parseInt(hex.slice(1, 3), 16) / 255;
    const g = parseInt(hex.slice(3, 5), 16) / 255;
    const b = parseInt(hex.slice(5, 7), 16) / 255;
    const max = Math.max(r, g, b),
      min = Math.min(r, g, b);
    let h,
      s,
      l = (max + min) / 2;

    if (max !== min) {
      const d = max - min;
      s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
      switch (max) {
        case r:
          h = (g - b) / d + (g < b ? 6 : 0);
          break;
        case g:
          h = (b - r) / d + 2;
          break;
        case b:
          h = (r - g) / d + 4;
          break;
      }
      h /= 6;
    } else {
      h = s = 0;
    }

    return {
      h: Math.round(h * 360),
      s: Math.round(s * 100),
      l: Math.round(l * 100),
    };
  }

  function generateShades(baseHex) {
    const { h, s } = hexToHSL(baseHex);
    const shades = [];
    for (let i = 9; i >= 1; i--) {
      const l = 15 + i * 8;
      shades.push(`hsl(${h}, ${s}%, ${l}%)`);
    }
    return shades;
  }

  function rgbToHex(rgbStr) {
    const result = rgbStr
      .match(/\d+/g)
      .map((n) => parseInt(n).toString(16).padStart(2, "0"));
    return `#${result.join("")}`;
  }

  function getAccessibleTextColor(hex) {
    const bigint = parseInt(hex.slice(1), 16);
    const r = (bigint >> 16) & 255,
      g = (bigint >> 8) & 255,
      b = bigint & 255;
    const srgb = [r, g, b].map((v) => {
      v /= 255;
      return v <= 0.03928 ? v / 12.92 : Math.pow((v + 0.055) / 1.055, 2.4);
    });
    const l = 0.2126 * srgb[0] + 0.7152 * srgb[1] + 0.0722 * srgb[2];
    const white = (1 + 0.05) / (l + 0.05);
    const black = (l + 0.05) / 0.05;
    return white >= black ? "white" : "black";
  }

  function updateColorMode() {
    const useHex = !document.getElementById("colorToggle").checked;
    document.querySelectorAll(".color-cell").forEach((cell) => {
      const hex = cell.dataset.hex;
      const rgb = cell.dataset.rgb;
      const label = cell.querySelector(".color-label");
      const overlay = cell.querySelector(".copy-overlay");
      const display = useHex ? hex : rgb;
      const contrast = getAccessibleTextColor(hex);

      label.textContent = display;
      label.style.color = contrast;
      overlay.style.color = "white";
      cell.dataset.color = display;
    });
  }

  function copyColor(el) {
    const color = el.dataset.color;
    const overlay = el.querySelector(".copy-overlay");
    const label = el.querySelector(".color-label");

    overlay.textContent = "Copied!";
    overlay.classList.remove("opacity-0");
    label.classList.add("opacity-0");

    navigator.clipboard.writeText(color).then(() => {
      setTimeout(() => {
        overlay.textContent = "Click to copy";
        overlay.classList.add("opacity-0");
        label.classList.remove("opacity-0");
      }, 1000);
    });
  }

  function renderColorBlocks() {
    const grid = document.getElementById("colorGrid");
    grid.innerHTML = "";

    colors.forEach((color) => {
      const wrapper = document.createElement("div");

      const main = document.createElement("div");
      main.className =
        "color-cell relative w-full h-32 shadow cursor-pointer flex items-center justify-center group rounded-t-md";
      main.style.backgroundColor = color.hex;
      main.dataset.hex = color.hex;
      main.dataset.rgb = color.rgb;
      main.dataset.color = color.hex;
      main.onclick = () => copyColor(main);

      const label = document.createElement("span");
      label.className =
        "color-label text-white text-base font-bold tracking-wide transition-opacity group-hover:opacity-0";
      label.textContent = color.hex;

      const overlay = document.createElement("span");
      overlay.className =
        "copy-overlay absolute inset-0 flex items-center justify-center text-white text-sm font-semibold bg-black/60 rounded-t-md opacity-0 transition-opacity group-hover:opacity-100";

      overlay.textContent = "Click to copy";

      main.appendChild(label);
      main.appendChild(overlay);
      wrapper.appendChild(main);

      const shadeRow = document.createElement("div");
      shadeRow.className = "flex w-full h-16";

      generateShades(color.hex).forEach((shade) => {
        const shadeDiv = document.createElement("div");
        shadeDiv.className =
          "h-full relative group cursor-pointer transition-shadow hover:shadow-[inset_0_0_0_3px_white]";

        shadeDiv.classList.add("flex-1");

        shadeDiv.style.backgroundColor = shade;
        const iconWrapper = document.createElement("div");
        iconWrapper.className = `
              absolute top-1/2 left-1/2 
              transform -translate-x-1/2 -translate-y-1/2 
              bg-black/60 
              rounded 
              transition-opacity 
              opacity-0 
              group-hover:opacity-100 
              pointer-events-none 
              cursor-none 
              px-2 py-1
            `
          .trim()
          .replace(/\s+/g, " ");

        const icon = document.createElement("i");
        icon.className = `
              fas fa-clipboard 
              text-white 
              text-xl 
              absolute 
              top-1/2 left-1/2 
              transform -translate-x-1/2 -translate-y-1/2 
              opacity-0 
              group-hover:opacity-100 
              transition-opacity 
              pointer-events-none 
              drop-shadow-[0_0_2px_black] 
              cursor-none
            `
          .trim()
          .replace(/\s+/g, " ");

        shadeDiv.appendChild(icon);

        shadeDiv.onclick = () => {
          const useHex = !document.getElementById("colorToggle").checked;
          const rgb = getComputedStyle(shadeDiv).backgroundColor;
          const textToCopy = useHex ? rgbToHex(rgb) : rgb;

          navigator.clipboard.writeText(textToCopy).then(() => {
            icon.className = icon.className.replace("fa-clipboard", "fa-check");
            setTimeout(() => {
              icon.className = icon.className.replace(
                "fa-check",
                "fa-clipboard",
              );
            }, 1000);
          });
        };

        shadeRow.appendChild(shadeDiv);
      });

      wrapper.appendChild(shadeRow);
      grid.appendChild(wrapper);
    });
  }

  document.addEventListener("DOMContentLoaded", () => {
    renderColorBlocks();
    updateColorMode();
    document
      .getElementById("colorToggle")
      .addEventListener("change", updateColorMode);
  });

  function copySource(button) {
    const input = button.previousElementSibling;
    navigator.clipboard.writeText(input.value).then(() => {
      const icon = button.querySelector("i");
      icon.classList.replace("fa-clipboard", "fa-check");
      setTimeout(() => {
        icon.classList.replace("fa-check", "fa-clipboard");
      }, 1000);
    });
  }
</script>
