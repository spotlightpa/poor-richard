{{ $hed := .Get "hed" }}
{{ $dek := .Get "dek" }}
{{ $outro := .Get "outro" }}


<h3>
  {{ $hed }}
</h3>
<p>
  {{ $dek }}
</p>

<script src="https://player.vimeo.com/api/player.js"></script>
<div class="my-8 min-h-screen w-full md:my-11">
  {{ .Inner }}


  <p
    class="mx-auto mb-1 mt-8 max-w-5xl select-text p-2 text-xs italic text-s-8 xl:text-sm"
  >
    {{ $outro }}
  </p>
</div>
<script>
  let videos = document.querySelectorAll("div[data-vimeo]");

  let videoItems = Array.prototype.slice.call(videos);
  console.log(videoItems[0]);

  function checkVisible(elm, threshold, mode) {
    // Add checkVisible function
    threshold = threshold || 0;
    mode = mode || "visible";

    var rect = elm.getBoundingClientRect();
    var viewHeight = Math.max(
      document.documentElement.clientHeight,
      window.innerHeight
    );
    var above = rect.bottom - threshold < 0;
    var below = rect.top - viewHeight + threshold >= 0;

    return mode === "above"
      ? above
      : mode === "below"
      ? below
      : !above && !below;
  }

  function videoPlayPause(videoItem, scrollPlayer) {
    // Play if element is in the viewport
    if (checkVisible(videoItem)) {
      console.log(videoItem.getAttribute("id"));
      scrollPlayer.play();
    } else {
      scrollPlayer.pause();
    }
  }

  videoItems.forEach(function (videoItem) {
    // console.log(videoItem);
    let elId = videoItem.getAttribute("id");
    let videoId = videoItem.getAttribute("data-vimeo");
    console.log("identifies: " + elId + " vimeo: " + videoId);

    function videoLoader(elId, vimeoID) {
      // Load Vimeo video into target element
      var options = {
        id: vimeoID,
        height: 576,
        responsive: true,
        loop: true,
        title: 0,
        sidedock: 0,
        controls: 0,
      };
      var player = new Vimeo.Player(elId, options);
      player.setVolume(0);

      player.on("loaded", function () {
        console.log("Video loaded: " + videoId);
      });

      player.on("play", function () {
        console.log("Played video: " + videoId);
      });
      player.on("pause", function () {
        console.log("paused the video: " + videoId);
      });

      return player;
    }

    vid = videoLoader(videoItem, videoId);

    window.onscroll = function () {
      console.log(videoId + ": videoPlayPause");
      videoPlayPause(videoItem, vid);
    };
  });
</script>
