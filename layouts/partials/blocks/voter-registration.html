{{ define "extra-head" }}
  {{ partial "header/maplibre.html" . }}
{{ end }}

{{ define "extra-footer" }}
  {{ partial "blocks/maplibre.html" . }}
{{ end }}

{{ partial "s3-data-loader.html" . }}

<div x-data="s3DataLoader()" x-init="init()">
  <div class="grid grid-cols-1 gap-4 md:grid-cols-2">
    <div
      class="flex h-96 flex-col justify-center rounded-lg border-2 border-black bg-white p-6 text-left text-black"
    >
      <p class="mb-4 text-2xl font-semibold">Total Registered Voters</p>
      <p
        class="text-4xl font-bold"
        x-text="totalRegistered().toLocaleString()"
      ></p>

      <div class="mt-6 space-y-2">
        <template x-for="row in partyRows()" :key="row.Party">
          <p class="text-lg">
            <span x-text="row.Party"></span>:
            <span class="font-bold" x-text="row.Total.toLocaleString()"></span>
          </p>
        </template>
      </div>
    </div>

    <div class="h-96 overflow-hidden rounded-lg">
      <div class="relative h-full w-full">
        <div
          x-data='maplibreComponent({
            id: "pa-map",
            styleURL: "https://tiles.openfreemap.org/styles/positron",
            bounds: [[-80.5199, 39.7198], [-74.6895, 42.26986]],
            padding: 24,
            minZoom: 3,
            maxZoom: 18,
            zoom: 6,
            controls: ["navigation","fullscreen"],
            attributionCompact: true,
            ariaLabel: "Pennsylvania voter registration map",
            class: "relative w-full h-full"
          })'
          x-init="init()"
          role="region"
          aria-label="Pennsylvania voter registration map"
          class="absolute inset-0"
        >
          <div x-ref="canvas" class="h-full w-full"></div>
        </div>

        <div
          x-data="{ selected: 'county' }"
          class="absolute right-[50px] top-[10px] z-20 flex overflow-hidden rounded-md border border-g-3 bg-white shadow"
        >
          <button
            :data-checked="selected === 'county'"
            @click="selected='county'"
            title="County"
            class="border-r border-g-3 px-3 py-2 text-sm font-semibold text-black hover:bg-g-1 focus:outline-none focus:ring-2 focus:ring-g-4 active:bg-g-2 data-[checked=true]:bg-g-2"
          >
            Counties
          </button>

          <button
            :data-checked="selected === 'congressional'"
            @click="selected='congressional'"
            title="Congressional"
            class="border-r border-g-3 px-3 py-2 text-sm font-semibold text-black hover:bg-g-1 focus:outline-none focus:ring-2 focus:ring-g-4 active:bg-g-2 data-[checked=true]:bg-g-2"
          >
            Congressional
          </button>

          <button
            :data-checked="selected === 'senate'"
            @click="selected='senate'"
            title="Senate"
            class="border-r border-g-3 px-3 py-2 text-sm font-semibold text-black hover:bg-g-1 focus:outline-none focus:ring-2 focus:ring-g-4 active:bg-g-2 data-[checked=true]:bg-g-2"
          >
            Senate
          </button>

          <button
            :data-checked="selected === 'house'"
            @click="selected='house'"
            title="House"
            class="px-3 py-2 text-sm font-semibold text-black hover:bg-g-1 focus:outline-none focus:ring-2 focus:ring-g-4 active:bg-g-2 data-[checked=true]:bg-g-2"
          >
            House
          </button>
        </div>
      </div>
    </div>

    <div class="flex h-96 items-center justify-center bg-red">
      <p class="text-2xl font-semibold text-white">Block 3</p>
    </div>

    <div class="flex h-96 items-center justify-center bg-orange">
      <p class="text-2xl font-semibold text-white">Block 4</p>
    </div>
  </div>
</div>
