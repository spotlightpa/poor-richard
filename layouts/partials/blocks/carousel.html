<div id="carousel-container" class="carousel-container pt-16">
  <div class="carousel-arrow left-arrow">
    <svg class="h-16 w-16 fill-white">
      {{ partial "helper/svg.html" "chevron-left" }}
    </svg>
  </div>

  <div id="carousel-content" class="carousel-content">
    {{ range $index, $item := site.Data.carousel.items }}
      <div class="carousel-item" data-index="{{ $index }}">
        <div class="carousel-blurb">
          <div class="carousel-grid">
            <div class="carousel-title">{{ $item.title }}</div>
            <div class="carousel-tagline">{{ $item.tagline }}</div>
            <div class="carousel-text">{{ $item.text }}</div>
            <div class="read-the-series">
              <a href="{{ $item.link }}" target="_blank">
                {{ $item.linkText }}
                <svg class="h-5 w-5 fill-black">
                  {{ partial "helper/svg.html" "right" }}
                </svg>
              </a>
            </div>
          </div>
        </div>
        <div class="carousel-photo"></div>
      </div>
    {{ end }}
  </div>

  <div class="carousel-arrow right-arrow">
    <svg class="h-16 w-16 fill-white">
      {{ partial "helper/svg.html" "chevron-right" }}
    </svg>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const carouselItems = document.querySelectorAll(".carousel-item");
    const carouselContent = document.getElementById("carousel-content");
    const leftArrow = document.querySelector(".left-arrow");
    const rightArrow = document.querySelector(".right-arrow");

    let currentIndex = 0;

    function calculateMaxHeight() {
      let maxHeight = 0;
      carouselItems.forEach((item) => {
        item.style.display = "flex";
        const height = item.scrollHeight;
        if (height > maxHeight) {
          maxHeight = height;
        }
        item.style.display = "none";
      });
      return maxHeight;
    }

    function setCarouselHeight() {
      const maxHeight = calculateMaxHeight();
      carouselContent.style.minHeight = `${maxHeight}px`;
    }

    function updateCarousel() {
      carouselItems.forEach((item, index) => {
        item.style.display = index === currentIndex ? "flex" : "none";
      });
      updateArrowStates();
    }

    function updateArrowStates() {
      leftArrow.style.opacity = currentIndex === 0 ? "0.3" : "1";
      leftArrow.style.pointerEvents = currentIndex === 0 ? "none" : "auto";

      rightArrow.style.opacity =
        currentIndex === carouselItems.length - 1 ? "0.3" : "1";
      rightArrow.style.pointerEvents =
        currentIndex === carouselItems.length - 1 ? "none" : "auto";
    }

    function navigateCarousel(direction) {
      if (direction === "left" && currentIndex > 0) currentIndex--;
      if (direction === "right" && currentIndex < carouselItems.length - 1)
        currentIndex++;
      updateCarousel();
    }

    leftArrow.addEventListener("click", () => navigateCarousel("left"));
    rightArrow.addEventListener("click", () => navigateCarousel("right"));

    setCarouselHeight();
    updateCarousel();

    window.addEventListener("resize", () => {
      setCarouselHeight();
      updateCarousel();
    });
  });
</script>

<style>
  .carousel-container {
    display: flex;
    align-items: center;
    position: relative;
    width: 100%;
    overflow: hidden;
  }

  .carousel-arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    z-index: 3;
    cursor: pointer;
  }

  .carousel-arrow.left-arrow {
    left: 5px;
  }

  .carousel-arrow.right-arrow {
    right: 5px;
  }

  .carousel-arrow svg {
    fill: #ffffff;
  }

  .carousel-title {
    font-size: 2.5rem;
    color: #ffffff;
    font-weight: bold;
  }

  .carousel-tagline {
    font-size: 0.75rem;
    line-height: 1rem;
    background-color: #fff;
    text-transform: uppercase;
    font-weight: 600;
    width: fit-content;
    padding: 0.5rem;
  }

  .carousel-text {
    color: #ffffff;
  }

  .carousel-text::first-letter {
    font-size: 4rem;
    font-weight: medium;
    float: left;
    margin-right: 5px;
    line-height: 1;
  }

  .read-the-series a {
    display: inline-flex;
    align-items: center;
    font-weight: bold;
    background-color: #ffffff;
    text-align: center;
    padding: 10px 50px;
    border-radius: 5px;
    cursor: pointer;
    text-decoration: none;
    color: inherit;
    max-width: 100%;
  }

  .read-the-series a svg {
    margin-left: 10px;
  }

  .carousel-content {
    display: flex;
    flex-direction: row;
    width: 100%;
    position: relative;
    overflow: visible;
  }

  .carousel-photo,
  .carousel-blurb {
    flex: 1;
    min-height: auto;
  }

  .carousel-photo {
    background-color: blue;
  }

  .carousel-blurb {
    padding: 100px;
    background-color: rgba(0, 0, 0, 0.7);
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: visible;
  }

  .carousel-grid {
    display: grid;
    grid-template-rows: auto auto 1fr auto;
    gap: 20px;
    width: 100%;
  }

  .carousel-item {
    display: none;
    flex-direction: row;
  }

  .carousel-item.flex {
    display: flex;
  }
</style>
