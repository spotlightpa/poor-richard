{{ $baseURL := getenv "IMGPROXY_URL" | default "https://images.data.spotlightpa.org" }}
{{ $signature := "insecure" }}
{{ $resizing_type := .resize | default "fit" }}
{{ $width := .width }}
{{ $height := .height }}
{{ $gravity := .gravity | default "sm" }}
{{ $enlarge := "1" }}
{{ $encoded_source_url := .filename | base64Encode }}
{{ $extension := "jpeg" }}
{{ if strings.HasSuffix .filename ".png" }}
  {{ $extension = "png" }}
{{ end }}
{{ $quality := 75 }}

{{ $url := printf "%s/%s/rs:%s:%d:%d/g:%s/el:%s/q:%d/%s.%s" $baseURL $signature $resizing_type $width $height $gravity $enlarge $quality $encoded_source_url $extension }}

{{ return ($url | absURL) }}
