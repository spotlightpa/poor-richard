{{ $idEmail := partial "helper/new-id" . | printf "modal-newsletter-%s" }}
{{ $imagename := .filename }}
{{ $actionColor := .actionColor | default "#FFCB05" }}
{{ $newsletterAction := site.Param "newsletters-action" }}


<div
  class="fixed inset-0 z-20 overflow-y-scroll"
  data-ga-category="modal:newsletter:multi"
  x-data="modal"
  x-cloak
  x-show="isOpen"
  x-trap.noscroll.inert="isOpen"
  @open-sticky.window="show()"
  role="dialog"
  aria-modal="true"
  aria-label="Newsletter sign up"
>
  <div class="absolute inset-0 bg-s-4 opacity-75"></div>
  <div
    class="absolute inset-0 backdrop-blur-sm backdrop-filter"
    x-transition.opacity
  ></div>
  <div
    class="absolute inset-0 flex items-center overflow-y-auto"
    x-show="isOpen"
    x-ref="content"
    x-transition
    tabindex="-1"
    @click.stop
    @keydown.escape="isOpen = false"
  >
    <div class=" mt-36 w-full overflow-y-scroll pt-11">
      <div
        style="background-color: {{ $actionColor }};"
        class="w-full border-b-2 border-t-2 font-sans"
      >
        <div
          class="mx-5 -mt-11 grid max-w-screen-xl grid-cols-6 items-start gap-x-5 md:mx-auto md:mr-auto md:ml-auto md:grid-cols-12"
        >
          <button
            style="color: {{ $actionColor }};"
            class="col-start-6 flex text-s-4  md:col-start-10 md:row-start-1"
            type="button"
            aria-label="close"
            x-ref="closer"
            data-ga-action="modal:newsletter:dismiss"
            @keydown.escape="isOpen = false"
            @click="isOpen = false;"
            :autofocus="isOpen"
          >
            <svg
              class="my-auto box-content h-5 w-5 fill-black p-3"
              style="margin-right: -2px;"
            >
              {{ partial "helper/svg.html" "close" }}
            </svg>
          </button>
          <form
            class="col-span-5 col-start-1 row-start-1 -mr-5 grid-cols-[repeat(5,_auto)] gap-0 overflow-hidden rounded border-2
          bg-white md:col-span-7 md:col-start-3 md:row-start-1 md:-ml-5 md:grid md:flex-col md:flex-wrap"
            data-ga-form="newsletters:multi"
            x-data="{ hasFocused: false }"
            action="{{ $newsletterAction }}"
            method="post"
            target="_blank"
            tabindex="-1"
            @click.stop
            @keydown.escape="isOpen = false"
          >
            {{ with $imagename }}
              <div
                class="-mt-14 flex aspect-video items-stretch justify-center self-stretch overflow-hidden rounded-tr md:col-start-3 md:row-start-1 md:row-end-4 md:mt-0 md:aspect-auto"
              >
                {{ $sizes := (slice
                  (dict "width" 256 "height" 256)
                  (dict "width" 512 "height" 512)
                  )
                }}
                {{ $srcset := partial "helper/build-srcset" (dict
                  "sizes" $sizes
                  "filename" $imagename
                  "gravity" "ce"
                  )
                }}

                {{ $imgOpt := dict
                  "filename" $imagename
                  "width" 256
                  "height" 256
                  "gravity" "ce"
                }}
                {{ $imgSmallSrc := partial "helper/imgproxy" $imgOpt }}
                {{ partial "tag/picture.html" (dict
                  "pictureClass" "w-full flex"
                  "imgClass" "w-full object-cover"
                  "sizeHint" "256px"
                  "eager" false
                  "description" ""
                  "srcset" $srcset
                  "src" $imgSmallSrc
                  "width" 256
                  "height" 256
                  )
                }}
              </div>
            {{ end }}
            <header class="mx-5 mt-6 md:col-start-1 md:col-end-3">
              <h2 class=" text-2xl font-extrabold md:text-3xl lg:text-4xl">
                Investigative Journalism for Pennsylvania
              </h2>
              <p class="mt-2 max-w-lg text-xl">
                Get every Spotlight PA story and the best investigative
                journalism from across Pa.
              </p>
            </header>
            <div
              class="m-5 flex max-w-md flex-wrap items-stretch justify-start space-y-4 sm:flex-nowrap md:col-start-1 md:col-end-3"
            >
              {{ partial "newsletter/hidden-input.html" . }}
              <label class="sr-only" for="{{ $idEmail }}">Email address</label>
              <input
                id="{{ $idEmail }}"
                class=" box-border w-full appearance-none rounded rounded-tl rounded-bl border border-black bg-white p-2 tracking-wider text-s-8 placeholder-s-6 placeholder-opacity-100 outline-none ring-blue-2 focus:ring-2 sm:w-7/12 sm:rounded-tr-none sm:rounded-br-none"
                @focus.once="hasFocused = true"
                type="email"
                name="EMAIL"
                placeholder="Email address"
                required
              />
              <button
                style="color: {{ $actionColor }};"
                class=" box-border w-5/12 rounded bg-black py-2 font-black tracking-wider hover:shadow sm:rounded-t-none sm:rounded-b sm:rounded-bl-none sm:rounded-tr md:px-8"
                type="submit"
              >
                Sign Up
              </button>
            </div>
            <div
              class=" col-span-3 col-start-1 rounded-b-sm border-t-2 bg-s-3 px-6 pt-5 pb-9"
              x-cloak
              x-show="hasFocused"
              x-transition:enter="transition ease-in-out duration-300"
              x-transition:enter-start="opacity-0"
              x-transition:enter-end="opacity-100"
              x-transition:leave="transition ease-in duration-300"
              x-transition:leave-start="opacity-100"
              x-transition:leave-end="opacity-0"
            >
              {{ $checkClass := `accent-orange` }}
              <p class="mt-3 text-left">
                <label>
                  <input
                    type="checkbox"
                    class=" mr-3 h-4 w-4 rounded border border-black p-1 accent-black hover:accent-yellow-4"
                    name="papost"
                    value="1"
                    checked
                    data-ga-button
                    data-ga-action="toggle-newsletter:papost"
                  />
                  <strong>PA Post (Daily)</strong>: Top news every weekday
                  morning, plus a daily puzzle.
                </label>
              </p>
              <p class="mt-1 text-left">
                <label>
                  <input
                    type="checkbox"
                    class=" mr-3 h-4 w-4 rounded border border-black p-1 accent-black hover:accent-yellow-4"
                    name="investigator"
                    value="1"
                    checked
                    data-ga-button
                    data-ga-action="toggle-newsletter:investigator"
                  />
                  <strong>The Investigator (Weekly)</strong>: Best
                  accountability journalism every Thursday, plus a weekly
                  riddle.
                </label>
              </p>
              <p class="mt-1 text-left">
                <label>
                  <input
                    type="checkbox"
                    class=" mr-3 h-4 w-4 rounded border border-black p-1 accent-black hover:accent-yellow-4"
                    name="palocal"
                    value="1"
                    checked
                    data-ga-button
                    data-ga-action="toggle-newsletter:palocal"
                  />
                  <strong>PA Local (Weekly)</strong>: A fresh look at the
                  incredible people, places, and food of Pa. every Friday.
                </label>
              </p>
            </div>
          </form>
          <p
            class=" col-span-6 col-start-1 flex leading-tight md:col-span-7 md:col-start-3"
          >
            <button
              class="flex-initial py-3 pr-5 text-black underline md:mr-5"
              aria-label="close"
              type="button"
              @click="
              $dispatch('x-form-submit', 'newsletters:seenit:submit');
              isOpen = false
            "
            >
              Iâ€™m already a subscriber
            </button>
            <button
              class=" flex-initial py-4 pr-5 text-black  underline md:mr-5"
              aria-label="close"
              type="button"
              @click="isOpen = false"
            >
              No thanks
            </button>
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
