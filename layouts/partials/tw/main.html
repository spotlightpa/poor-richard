{{ $params := partialCached "helper/page-params" .Page .RelPermalink }}

<section class="py-6 px-4 bg-white text-g-9">
  <article class="mx-auto max-w-prose">
    {{ if $params.showTitle }}
      <header
        data-ga-category="header"
      >
        {{ if $params.rubric }}
          <a
            class="inline-block px-3 bg-black text-white text-base font-sans font-semibold uppercase"
            href="{{ $params.rubric.RelPermalink }}"
          >{{ $params.kicker | default $params.rubric.Title }}</a>
        {{ else if $params.kicker }}
          <p
            class="inline-block px-3 bg-black text-white text-base font-sans font-semibold uppercase"
          >{{ $params.kicker }}</p>
        {{ end }}

        <h1 class="mt-1 text-black text-2xl sm:text-4xl font-semibold leading-tight tracking-tight">
          {{ .Title }}
        </h1>

        {{ with $params.byline }}
          <h3 class="mt-1 text-g-7 font-sans text-base font-light leading-tight sm:leading-normal tracking-normal">
            <span class="font-semibold">
              by
              <span
                itemtype="http://schema.org/Person"
                itemprop="author"
              >
                {{- $params.byline -}}
              </span>
            </span>
            {{ if $params.published }}
              |
              <time
                datetime='{{ $params.publishedISO }}'
              >{{ $params.published }}</time>
            {{ end }}
          </h3>
        {{ end }}

        <div class="mt-4">
          {{ partial "tw/social-buttons.html" . }}
        </div>
      </header>
    {{ end }}

    {{ partial "tw/hero-image-block.html" . }}

    <div
      class="mt-6"
      data-ga-category="content"
    >
      <div
        x-data
        x-intersect.once="$dispatch('open-sticky')"
      ></div>
      <div
        x-data
        x-intersect.once="$report({ target: $el })"
        data-ga-action="view:content-start"
      ></div>
      <div
        class="article-content leading-relaxed"
        data-sf-campaign="701f4000000TVuXAAW"
      >
        {{ .Content }}
      </div>
      <div
        x-data
        x-intersect.once="$report({ target: $el })"
        data-ga-action="view:content-finish"
      ></div>
    </div>

    {{ with .Param "authors" }}
      <footer
        class="mt-6 space-y-6"
        data-ga-category="inline-footer:author"
      >
        {{ range $name := . }}
          {{ $author := partial "helper/get-author" $name }}
          {{ if $author.link }}
            <a
              class="flex items-center space-x-6"
              href="{{ $author.link }}">
                {{ template "main-author-loop" $author }}
            </a>
          {{ else }}
            <div class="flex items-center space-x-6">
              {{ block "main-author-loop" $author }}
                {{ if .thumb }}
                  <span class="inline-flex w-16 h-16">
                    <img
                      src="{{ .thumb }}"
                      alt="Photo of {{ .name }}"
                      class="m-auto ring-2 ring-g-6 rounded-full filter grayscale"
                      loading="lazy"
                      decoding="async"
                    >
                  </span>
                {{ else }}
                  <span class="inline-flex w-16"></span>
                {{ end }}
                <div class="font-sans font-semibold leading-tight">
                  {{ $showLink := and .active .link | not | not }}
                  {{ $color := cond $showLink "text-blue" "text-g-7" }}
                  <h3 class="text-2xl {{ $color}}">
                        {{ .name }}
                  </h3>
                  {{ if and .active .title }}
                    <h3 class="text-lg text-g-6">
                      {{ .title }}
                    </h3>
                  {{ end }}
                </div>
              {{ end }}
            </div>
          {{ end }}
        {{ end }}
      </footer>
    {{ end }}
    {{ partial "tw/support.html" . }}
  </article>

  {{ if .Param "suppress-related" | not }}
    {{ $news := site.GetPage "/news/_index.md" }}
    {{ $related := $news.RegularPages.Related . | first 3 }}
    {{ partial "tw/related-articles.html" $related }}
  {{ end }}

  {{ partialCached "tw/promo-footer.html" (dict "wrapperClass" "py-8 no-js-hide") }}
</section>
