<a href="#main" class="sr-only focus:not-sr-only focus:absolute">
  <span class="m-4 font-sans font-bold underline"> Skip to main content </span>
</a>

<div
  class="top-0 z-[1000] border-b border-black bg-beige font-sans shadow-lg"
  x-data="{ isOpen: false }"
  data-ga-category="top-banner"
  data-sf-campaign="701Dn000000YgosIAC"
  aria-labelledby="top"
>
  <div
    class="mx-auto flex max-w-screen-xl flex-wrap items-center justify-between gap-x-2 px-3 py-2 sm:gap-x-6 lg:relative xl:px-0"
  >
    <div
      class="sm:order-0 z-40 h-10 w-40 max-sm:flex-auto sm:flex sm:h-12 sm:w-56 sm:flex-auto sm:flex-grow-0  sm:items-stretch sm:justify-center md:h-14 md:w-72"
      :class="isOpen ? 'sm:translate-y-2' : ''"
    >
      <a id="top" class="h-10 sm:h-12 md:h-14" href="/" data-ga-category="logo">
        <svg
          class="block h-10 w-40 sm:h-12 sm:w-full md:h-14"
          :class="{ 'hidden': !atTop, 'block': atTop }"
        >
          <title>Spotlight PA Home</title>
          {{ partial "helper/svg.html" "banner" }}
        </svg>
        <svg
          class="hidden h-10 w-10 sm:h-12 sm:w-12 md:h-14 md:w-14"
          :class="{ 'hidden': atTop, 'sm:block': !atTop }"
        >
          <title>Spotlight PA Home</title>
          {{ partial "helper/svg.html" "logo" }}
        </svg>
      </a>
    </div>

    <nav
      @keydown.escape.prevent.stop="isOpen = false"
      @click.outside="isOpen = false"
      @focusin.outside="isOpen = false"
      class="sm:-order-1 sm:flex-1"
    >
      <div
        id="hamburger-menu"
        x-cloak
        class="
        max-w-screen absolute left-2 right-2 top-0 z-30 max-h-screen overflow-x-hidden rounded border border-g-5 bg-white py-12 after:absolute after:left-0
        after:right-0 after:top-0 after:z-30 after:h-20 after:bg-gradient-to-b
        after:from-white after:via-white after:to-transparent after:content-[''] sm:left-auto sm:right-3 sm:w-[calc(100%_-_1.5rem)] sm:grid-cols-2 lg:left-0 lg:right-0
        "
        :class="{ 'hidden': !isOpen, '': isOpen }"
        x-trap="isOpen"
        role="menu"
        aria-labelledby="hamburger-button"
        :aria-expanded="isOpen"
      >
        <div
          class="grid grid-cols-2 gap-5 px-4 sm:grid-cols-4 md:mx-auto md:mt-16 md:max-w-screen-lg xl:gap-12"
        >
          {{ $context := dict
            "category" "news"
            "menu" site.Menus.news
            "name" "News"
            "link" "/news/"
          }}
          {{ block "tw-header" $context }}
            <div class="mt-10 text-sm" data-ga-category="{{ .category }}">
              <h3 class="font-bold uppercase tracking-wide hover:underline">
                <a
                  class="transition-color text-black duration-500 hover:text-blue hover:underline"
                  href="{{ .link }}"
                  >{{ .name }}</a
                >
              </h3>
              <ul class="mt-3 space-y-4 leading-tight">
                {{ range .menu }}
                  <li>
                    <a
                      class="transition-color block text-black duration-500 hover:text-blue hover:underline"
                      href="{{ .URL }}"
                      {{ with .Params.dispatch }}
                        x-data @click.prevent="$dispatch($el.dataset.dispatch)"
                        data-dispatch="{{ . }}"
                      {{ end }}
                    >
                      {{- .Name -}}
                    </a>
                  </li>
                {{ end }}
              </ul>
            </div>
          {{ end }}
          {{ $context = dict
            "category" "newsletters"
            "menu" site.Menus.newsletters
            "name" "Newsletters"
            "link" "/newsletters/"
          }}
          {{ template "tw-header" $context }}
          {{ $context = dict
            "category" "about"
            "menu" site.Menus.about
            "name" "About"
            "link" "/about/"
          }}
          {{ template "tw-header" $context }}
          {{ $context = dict
            "category" "support"
            "menu" site.Menus.support
            "name" "Donate"
            "link" "/donate"
          }}
          {{ template "tw-header" $context }}

        </div>
      </div>

      <button
        id="hamburger-button"
        class="no-js:hidden sm-w-1/2 group
       relative z-40 mx-0 flex flex-row items-center gap-1 self-stretch"
        :class="isOpen ? 'sm:translate-x-8' : ''"
        type="button"
        @click="isOpen = ! isOpen"
        aria-controls="hamburger-menu"
        aria-haspopup="true"
        data-ga-category="burger"
        x-report-click
      >
        {{ block "nav-hamburger-button" . }}
          <span
            class="hidden text-sm font-bold uppercase leading-none tracking-wide text-black hover:underline hover:underline-offset-2 sm:inline-block md:leading-none"
            >Menu</span
          >
          <span class="flex h-5 w-5 cursor-pointer items-center justify-center">
            <span class="block space-y-1">
              <span
                class="block h-[2px] w-5 origin-center rounded-full bg-black transition-transform ease-in-out"
                :class="isOpen ? 'translate-y-1.5 rotate-45' : ''"
              ></span>
              <span
                class="block h-[2px] w-5 origin-center rounded-full bg-black transition-transform ease-in-out"
                :class="isOpen ? 'w-0 opacity-0' : 'opacity-1'"
              ></span>
              <span
                class="block h-[2px] w-3 origin-center rounded-full bg-black transition-transform ease-in-out"
                :class="isOpen ? 'w-5 -translate-y-1.5 -rotate-45' : ''"
              ></span>
            </span>
          </span>
        {{ end }}
      </button>
    </nav>
    <nav
      class="sm-w-1/2 relative z-40 order-1 flex items-center justify-end gap-5 sm:flex-1"
      :class="isOpen ? 'sm:-translate-x-10' : ''"
    >
      <a
        href="/newsletters"
        class="hidden text-sm font-bold uppercase leading-none tracking-wide text-black md:flex md:leading-none"
        >Newsletters
      </a>
      <a
        data-sf-campaign="701Dn000000YgosIAC"
        data-ga-category="donate"
        class="
          group flex items-center justify-around overflow-hidden rounded-md bg-gradient-to-r from-red-7 to-red p-2 hover:from-blue-7 hover:to-blue
          sm:flex sm:justify-center md:-my-1 md:px-4 md:py-2
          "
        href="/donate"
      >
        <span
          class="flex-0 relative inline-flex flex-wrap items-center text-xs font-bold uppercase leading-none tracking-wide text-white md:text-sm md:leading-none"
        >
          <svg
            class="mr-1 inline-block h-4 w-4 fill-current md:h-5 md:w-5"
            aria-hidden="true"
          >
            {{ partial "helper/svg.html" "heart" }}
          </svg>
          Donate
        </span>
      </a>
      <a
        href="/search/"
        class="z-40 hidden flex-row-reverse items-center justify-between lg:flex"
        data-ga-category="search"
        :class="isOpen ? 'translate-x-3 sm:translate-x-0' : ''"
        x-data
        @click.prevent="$dispatch('modal:search:open')"
      >
        <svg class="h-[14px] w-[14px]" aria-label="Search">
          {{ partial "helper/svg.html" "search" }}
        </svg>
        <span class="hidden">Search</span>
      </a>
    </nav>

    <p
      class="flex-0 order-1 -mx-3 -mb-3 mt-2 hidden w-screen border-t border-black
      bg-white py-3 text-center text-xs font-extrabold leading-none tracking-wide sm:m-0 sm:flex sm:justify-center sm:border-t-0 sm:bg-transparent md:text-base xl:text-base"
      :class="{ 'hidden': !atTop, 'sm:flex': atTop }"
    >
      Journalism that Gets Results <span class="font-normal">&#8480;</span>
    </p>
  </div>

  <nav
    class="hidden h-11 border-t bg-white font-sans sm:block"
    :class="{ 'sm:hidden': !atTop, 'sm:block': atTop }"
  >
    <div
      class="
      relative mx-auto flex h-full w-full max-w-screen-xl items-stretch justify-between px-3 md:justify-center"
    >
      <ul
        class="
        ml-1 box-content hidden max-w-4xl flex-1 items-center justify-evenly gap-2 overflow-hidden px-16 sm:flex md:px-0"
      >
        {{ range site.Menus.main }}
          <li
            class="
            flex h-max w-1/2 flex-1 items-center text-sm leading-none md:justify-center"
          >
            <a
              class="block flex-[0_0_auto] font-bold uppercase hover:underline hover:underline-offset-2 sm:font-normal"
              href="{{ .URL }}"
              data-ga-category="item"
            >
              {{- .Name -}}
            </a>
          </li>
        {{ end }}
      </ul>

      <!-- no JS fallback link to footer -->
      <a
        class="no-js:flex group z-40 order-1 mx-0 flex-[0_1_70px] flex-row items-center gap-1 self-stretch text-sm font-bold leading-none tracking-wide"
        href="#footer"
      >
        {{ template "nav-hamburger-button" . }}
      </a>
    </div>
  </nav>
</div>

<!-- hidden item classes to prevent alpinejs classes from being CSS purged -->
<div hidden>
  <span
    class="opacity-1 w-0 w-5 -translate-x-3 -translate-y-1.5 translate-x-3 translate-y-1.5 -rotate-45 rotate-45 opacity-0 sm:-translate-x-10 sm:translate-x-0 sm:translate-x-8 sm:translate-y-2 lg:translate-y-0"
    hidden
  ></span>
</div>

{{ define "nav-menu-item" }}
  <a
    class="
      flex w-full flex-1 justify-start border-b py-4 font-bold uppercase hover:underline hover:underline-offset-2
      sm:block sm:h-11 sm:capitalize"
    href="{{ .URL }}"
    data-ga-category="item"
  >
    {{- .Name -}}
  </a>
  {{ if .HasChildren }}
    <ul class="my-3 flex w-full flex-wrap gap-2">
      {{ range .Children }}
        <li
          class="flex h-max flex-[1_0_45%] items-center text-sm leading-none md:justify-center"
        >
          <a
            class="flex-1 py-1 hover:underline hover:underline-offset-2"
            href="{{ .URL }}"
            data-ga-category="item"
          >
            {{- .Name -}}
          </a>
        </li>
      {{ end }}
    </ul>
  {{ end }}
{{ end }}
