<!-- Panels -->
<div
  x-data="panels"
  class="relative col-span-8 col-start-1 row-span-3 row-start-1 w-full items-center justify-center md:col-span-14"
  @focus-panel.window="showPanel($event.detail)"
>
  <!-- PANEL NAVIGATION -->
  <button
    class="absolute left-0 top-0 z-20 h-full w-16 text-6xl text-g-1"
    type="button"
    @click="prev()"
    :aria-disabled="atBeginning"
    :tabindex="atBeginning ? -1 : 0"
    :class="{ 'opacity-25 cursor-not-allowed': atBeginning }"
  >
    <span aria-hidden="true">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="text-gray-600 h-16 w-16"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
        stroke-width="3"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M15 19l-7-7 7-7"
        />
      </svg>
    </span>
    <span class="sr-only">Skip to previous slide page</span>
  </button>

  <div role="tabpanels" class="relative bg-black" x-ref="container">
    <!-- Panel -->
    {{ range $i, $story := sort .impactStories "date" "desc" }}
      {{ if .page }}
        {{ $link := .page.Permalink }}
        <section
          data-pos="{{ $i }}"
          {{ if ne $i 0 }}x-cloak{{ end }}
          x-transition:enter="transition ease-out duration-1000 delay-300"
          x-transition:enter-start="opacity-0"
          x-transition:enter-end="opacity-100"
          x-transition:leave="transition ease-in"
          x-transition:leave-start="opacity-100"
          x-transition:leave-end="opacity-0 hidden"
          x-show="isSelected($el)"
          role="tabpanel"
          class="
            relative grid max-h-[768px] w-screen min-w-full grid-flow-row grid-cols-8 grid-rows-3 gap-3 overflow-x-hidden bg-g-7 before:z-10
            before:col-span-8 before:col-start-1 before:row-span-3 before:row-start-1 before:bg-black/80 before:bg-blend-overlay md:grid-cols-14 md:gap-5
          "
        >
          <div
            class="
              z-20 order-1 col-span-6 col-start-2 row-span-2 row-start-2 box-content flex max-w-md flex-col justify-center overflow-hidden text-white
              md:grid-cols-14 md:gap-5 md:pl-16
            "
          >
            {{ if .eyebrow }}
              <div data-ga-category="eyebrow">
                {{- partial "tag/maybe-link.html" (dict
                  "link" .rubricLink
                  "class" "bg-white text-black inline-block px-2 font-sans text-sm font-semibold uppercase border-eyebrow-bg border-2"
                  "text" .eyebrow
                  )
                -}}
              </div>
            {{ end }}
            <div class="mt-3 text-sm leading-relaxed md:text-xl">
              {{ .body | markdownify }}
            </div>
            <a
              href="{{ $link }}"
              class="
                col-start-1 mb-4 mt-14 self-start rounded border border-black bg-white px-4 py-2 text-center
                text-base font-bold leading-tight text-black no-underline duration-300 hover:border-red-7 hover:text-red-7 lg:text-lg
              "
              >Read the story &rarr;</a
            >
          </div>
          {{ $name := .page.Param "image" }}
          {{ $credit := .page.Param "image-credit" }}
          {{ $description := .page.Param "image-description" }}
          {{ $imgOpts := dict
            "filename" $name
            "description" $description
            "widthRatio" 5
            "heightRatio" 3
            "wrapperClass" "flex w-full h-full"
            "pictureClass" "flex w-full items-center justify-stretch"
            "imgClass" "self-center object-cover flex-1"
            "widths" (slice 576 488 1280 1920)
            "figClass" "flex col-start-1 col-span-8 row-start-1 row-span-3 overflow-hidden md:col-span-14 bg-black object-cover"
            "sizeHint" "400px"
            "gravity" (.page.Param "image-gravity")
          }}
          {{ partial "tw/image-block.html" $imgOpts }}
        </section>
      {{ end }}
    {{ end }}
  </div>

  <button
    class="absolute right-0 top-0 z-20 h-full w-16 text-6xl text-white"
    type="button"
    @click="next()"
    :aria-disabled="atEnd"
    :tabindex="atEnd ? -1 : 0"
    :class="{ 'opacity-50 cursor-not-allowed': atEnd }"
  >
    <span aria-hidden="true">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="text-gray-600 h-16 w-16"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
        stroke-width="3"
      >
        <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
      </svg>
    </span>
    <span class="sr-only">Skip to next slide page</span>
  </button>
</div>
