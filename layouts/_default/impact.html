{{ define "main" }}
  <section class="bg-white">
    {{ if .Params.pageTitle }}
      <h1
        class="mx-auto px-4 pt-16 text-4xl font-bold md:w-7/12 md:px-0 lg:text-5xl"
      >
        {{ .Params.pageTitle }}
      </h1>
    {{ end }}


    <div
      data-ga-category="content"
      class="article-content mx-auto w-full px-4 py-6 pb-10 md:w-7/12 md:px-0"
    >
      {{ if .Params.intro }}
        {{ .Params.intro | markdownify }}
      {{ end }}
    </div>

    <div id="award-quote-block" class="mx-auto md:w-7/12 md:px-0">
      <div
        class="article-content text-3xl md:px-0"
        style="text-decoration: none; margin-left: 50px;"
      >
        <blockquote>
          <p>
            <span style="white-space: nowrap;">
              <svg
                class="-ml-6 -mt-2 mr-1 inline-block h-9 w-9 fill-blue"
                aria-label="Quote"
              >
                {{ partial "helper/svg.html" "openquote" }}
              </svg>
              <span class="font-bold">If</span>
            </span>
            <span class="font-bold">
              you live in Pennsylvania, you gotta have Spotlight
            </span>
            <span style="white-space: nowrap;">
              <span class="font-bold">PA.</span>
              <svg
                class="-mt-2 mr-1 inline-block h-8 w-8 fill-blue"
                aria-label="Quote"
              >
                {{ partial "helper/svg.html" "closequote" }}
              </svg>
            </span>
          </p>

          <cite class="mt-4 block text-right text-lg italic">
            &ndash; <span>{{ .Params.quoteSource }}</span>
          </cite>
        </blockquote>
      </div>
    </div>

    <div id="carousel-outer-container" class="mb-16">
      {{ partial "blocks/carousel.html" }}
    </div>

    <div class="mx-auto w-full py-6 pb-4 md:w-7/12">
      {{ if .Params.howHead }}
        <h2 class="mb-4 px-4 text-3xl font-bold md:px-0">
          {{ .Params.howHead }}
        </h2>
      {{ end }}

      {{ if .Params.how }}
        <p
          class="text-gray-700 px-4 pb-16 text-lg font-normal leading-relaxed md:px-0"
        >
          {{ .Params.how }}
        </p>
      {{ end }}
    </div>

    {{ with site.Data.awards }}
      <div class="h-auto w-full bg-beige pb-16">
        <div class="mx-auto flex max-w-4xl items-center px-4 pb-4 pt-16">
          <svg class="mr-4 h-8 w-9" aria-hidden="true" style="fill: #b6b6b6;">
            {{ partial "helper/svg.html" "trophy" }}
          </svg>
          <h2 class="text-4xl font-bold">
            {{ $.Params.awardHead }}
          </h2>
        </div>

        <div class="mx-auto max-w-4xl px-4">
          <div style="border-top: 2.5px solid black; width: 100%;"></div>

          <div class="flex w-full">
            <div
              class="font-bold"
              style="padding: 15px 20px 15px 25px; border-right: 2.5px solid black;"
            >
              <ul class="year-list">
                {{ $years := slice }}
                {{ range . }}
                  {{ $years = $years | append .year }}
                {{ end }}
                {{ $sortedYears := uniq $years | sort }}
                {{ $count := len $sortedYears }}

                {{ range $index := seq 0 (sub $count 1) }}
                  <li>{{ index $sortedYears (sub (sub $count 1) $index) }}</li>
                {{ end }}
              </ul>
            </div>

            {{ $awards := site.Data.awards }}
            <script>
              document.addEventListener("DOMContentLoaded", () => {
                const yearList = document.querySelector(".year-list");
                const awardsContainer =
                  document.querySelector(".awards-container");

                if (!yearList || !awardsContainer) {
                  console.warn("No year list or awards container found.");
                  return;
                }

                const yearItems = yearList.querySelectorAll("li");
                yearItems.forEach((item) => {
                  item.addEventListener("click", () => {
                    const activeYear = item.textContent.trim();

                    yearItems.forEach((li) => li.classList.remove("active"));
                    item.classList.add("active");

                    const awardSections =
                      awardsContainer.querySelectorAll(".award-entity");
                    awardSections.forEach((award) => {
                      const awardYear = award.getAttribute("data-year");
                      award.style.display =
                        awardYear === activeYear ? "block" : "none";
                    });

                    const sections = [
                      {
                        header: ".national-awards-header",
                        container: ".national-awards",
                      },
                      {
                        header: ".national-finalists-header",
                        container: ".national-finalists",
                      },
                      {
                        header: ".state-awards-header",
                        container: ".state-awards",
                      },
                      {
                        header: ".state-finalists-header",
                        container: ".state-finalists",
                      },
                    ];

                    sections.forEach(({ header, container }) => {
                      const section = awardsContainer.querySelector(container);
                      const headerElement =
                        awardsContainer.querySelector(header);
                      const hasVisibleAwards = Array.from(
                        section.querySelectorAll(".award-entity"),
                      ).some((award) => award.style.display === "block");
                      headerElement.style.display = hasVisibleAwards
                        ? "block"
                        : "none";
                    });
                  });
                });

                yearItems[0]?.click();
              });
            </script>

            <div style="padding: 15px 15px 15px 25px;">
              <div class="awards-container">
                <p class="award-national-state national-awards-header">
                  National Awards
                </p>
                <div class="national-awards">
                  {{ range where (where . "national_or_state" "National") "winner_or_finalist_honorable_mention" "Winner" }}
                    <div class="award-entity" data-year="{{ .year }}">
                      {{ .entity }}:
                      <span class="award-category">{{ .award_category }}</span>
                      <p class="award-story">
                        {{ if .link }}
                          <a
                            href="{{ .link }}"
                            class="award-story-link"
                            target="_blank"
                            rel="noopener noreferrer"
                          >
                            {{ .story }}
                          </a>
                        {{ else }}
                          {{ .story }}
                        {{ end }}
                      </p>
                    </div>
                  {{ end }}
                </div>

                <p class="award-national-state national-finalists-header">
                  National Finalists
                </p>
                <div class="national-finalists">
                  {{ range where (where . "national_or_state" "National") "winner_or_finalist_honorable_mention" "Finalist/Honorable Mention" }}
                    <div class="award-entity" data-year="{{ .year }}">
                      {{ .entity }}:
                      <span class="award-category">{{ .award_category }}</span>
                      <p class="award-story">
                        {{ if .link }}
                          <a
                            href="{{ .link }}"
                            class="award-story-link"
                            target="_blank"
                            rel="noopener noreferrer"
                          >
                            {{ .story }}
                          </a>
                        {{ else }}
                          {{ .story }}
                        {{ end }}
                      </p>
                    </div>
                  {{ end }}
                </div>

                <p class="award-national-state state-awards-header">
                  State Awards
                </p>
                <div class="state-awards">
                  {{ range where (where . "national_or_state" "State") "winner_or_finalist_honorable_mention" "Winner" }}
                    <div class="award-entity" data-year="{{ .year }}">
                      {{ .entity }}:
                      <span class="award-category">{{ .award_category }}</span>
                      <p class="award-story">
                        {{ if .link }}
                          <a
                            href="{{ .link }}"
                            class="award-story-link"
                            target="_blank"
                            rel="noopener noreferrer"
                          >
                            {{ .story }}
                          </a>
                        {{ else }}
                          {{ .story }}
                        {{ end }}
                      </p>
                    </div>
                  {{ end }}
                </div>

                <p class="award-national-state state-finalists-header">
                  State Finalists
                </p>
                <div class="state-finalists">
                  {{ range where (where . "national_or_state" "State") "winner_or_finalist_honorable_mention" "Finalist/Honorable Mention" }}
                    <div class="award-entity" data-year="{{ .year }}">
                      {{ .entity }}:
                      <span class="award-category">{{ .award_category }}</span>
                      <p class="award-story">
                        {{ if .link }}
                          <a
                            href="{{ .link }}"
                            class="award-story-link"
                            target="_blank"
                            rel="noopener noreferrer"
                          >
                            {{ .story }}
                          </a>
                        {{ else }}
                          {{ .story }}
                        {{ end }}
                      </p>
                    </div>
                  {{ end }}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    {{ end }}

  </section>
{{ end }}
